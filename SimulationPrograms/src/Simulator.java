import java.util.Random;

public class Simulator {

    public double deviationAzimut;
    public double deviationElevation;
    public double holdingTime;
    private Random random;
    
    public Simulator(double deviationAzimut, double deviationElevation, double holdingTime) {
        
        this.deviationAzimut = deviationAzimut;
        this.deviationElevation = deviationElevation;
        this.holdingTime = holdingTime;
        this.random = new Random();
    }
    
    // Methode, die die werte durchgeht
    // @param Reader mit spezifischer Zeit, spezifischem Standort, Sonnenverlauf
    // @return 1. Dimension: Tageszeit, 2. Dimension: Standort

    public double[][] getDeviationOfLocation(Reader reader){

        double[][] returnValues = new double[reader.length - (int)(holdingTime/(5.0 * 60.0))][2];

        // iteriert durch die Zeiten, abh√§ngig von Wartezeit (hohe Wartezeit, wenig Messungen)
        for(int t = 0; t < reader.length - (int)(holdingTime/(5.0 * 60.0))-1; t++) {
            // streut random Messfehler (Azimut und Elevation)
            for (int i = 0; i < 100; i++) {
                
                double azimut1 = reader.getAzimut()[t] + 2 * deviationAzimut * random.nextDouble() - deviationAzimut;
                double elevation1 = reader.getElevation()[t] + 2 * deviationElevation * random.nextDouble() - deviationElevation;
                
                double azimut2 = reader.getAzimut()[t + (int)(holdingTime/(5.0 * 60.0))] + 2 * deviationAzimut * random.nextDouble() - deviationAzimut;
                double elevation2 = reader.getElevation()[t + (int)(holdingTime/(5.0 * 60.0))] + 2 * deviationElevation * random.nextDouble() - deviationElevation;
                
                int time = reader.getStartTime() + 60 * 5 * t;
                int date = reader.getDate() + 60 * 5 * t;

                double[] location = calculatePosition(azimut1, elevation1, time, date, azimut2, elevation2);
                returnValues[t][0] += Math.abs(location[0] - reader.getLocation()[0]);
                returnValues[t][1] += Math.abs(location[1] - reader.getLocation()[1]);
            }
            returnValues[t][0] /= 100;
            returnValues[t][1] /= 100;
        }
        return returnValues;
    }

    // Methode, die den Standort berechnet

    private double[] calculatePosition(double azimut3, double elevation3, int time, int date, double azimut4, double elevation4){
        
        double azimut1 = Math.PI / 180 * azimut3;
        double azimut2 = Math.PI / 180 * azimut4;
        double elevation1 = Math.PI / 180 * elevation3;
        double elevation2 = Math.PI / 180 * elevation4;

        double phi = Math.atan(-1 * Math.tan(elevation2) * Math.cos(azimut2 - Math.PI) - Math.sin(azimut2 - Math.PI) * (azimut2 - azimut1) / (elevation2 - elevation1));

        double woz = (648000 / (15 * Math.PI)) * (Math.atan(Math.sin(azimut2 - Math.PI) / (Math.cos(azimut2 - Math.PI) * Math.sin(phi) + Math.tan(elevation2) * Math.cos(phi))) + Math.PI);
        double lambda = (15 * Math.PI / 648000) * (woz - getZG((double)date) - (double)time);

        return new double[]{(180 / Math.PI) * phi, (180 / Math.PI) * lambda};
    }

    private double getZG(double x){
        double t = (x - 16027200) * 1000;
        double w = 2 * Math.PI / 31536000000.0;


        double y = -1457.6720543738566 * Math.cos(1 * w * t) + -273194.18299931486 * Math.cos(2 * w * t) + 8458.115482057558 * Math.cos(3 * w * t) + -10803.856768235639 * Math.cos(4 * w * t) + 602.6570186979338 * Math.cos(5 * w * t) + -434.16126452406434 * Math.cos(6 * w * t) + 10.832205954023767 * Math.cos(7 * w * t) + -28.77139775926428 * Math.cos(8 * w * t) + -7.775423695210777 * Math.cos(9 * w * t) + -5.41619194672767 * Math.cos(10 * w * t) + -1.9208145172026427 * Math.cos(11 * w * t) + 0.3160575808928215 * Math.cos(12 * w * t) + 2.0572770348254044 * Math.cos(13 * w * t) + 3.4110888941745756 * Math.cos(14 * w * t) + 4.5120546777701325 * Math.cos(15 * w * t) + 5.429425444774438 * Math.cos(16 * w * t) + 6.114411838500933 * Math.cos(17 * w * t) + 6.75655619990701 * Math.cos(18 * w * t) + 7.24718394852282 * Math.cos(19 * w * t) + 7.7209337396715165 * Math.cos(20 * w * t) + 8.083211811668876 * Math.cos(21 * w * t) + 8.407279563254145 * Math.cos(22 * w * t) + 8.691260915070455 * Math.cos(23 * w * t) + 8.935449022965978 * Math.cos(24 * w * t) + 9.139508659416395 * Math.cos(25 * w * t) + 9.360742721639678 * Math.cos(26 * w * t) + 9.516381783654854 * Math.cos(27 * w * t) + 9.717997277911298 * Math.cos(28 * w * t) + 9.815302339318514 * Math.cos(29 * w * t) + 9.949018600715835 * Math.cos(30 * w * t) + 10.043484178353303 * Math.cos(31 * w * t) + 10.167872314311625 * Math.cos(32 * w * t) + 10.270936781519532 * Math.cos(33 * w * t) + 10.375752998067087 * Math.cos(34 * w * t) + 10.442509642279733 * Math.cos(35 * w * t) + 10.501763575803528 * Math.cos(36 * w * t) + 10.525142833989594 * Math.cos(37 * w * t) + 10.559063713579583 * Math.cos(38 * w * t) + 10.64412896918346 * Math.cos(39 * w * t) + 10.709769156185276 * Math.cos(40 * w * t) + 10.746274290794043 * Math.cos(41 * w * t) + 10.796183086785623 * Math.cos(42 * w * t) + 10.846108899219159 * Math.cos(43 * w * t) + 10.887292698366586 * Math.cos(44 * w * t) + 10.913755269881884 * Math.cos(45 * w * t) + 10.975559132977805 * Math.cos(46 * w * t) + 10.985675821047822 * Math.cos(47 * w * t) + 11.009925869068637 * Math.cos(48 * w * t) + 11.047884574749352 * Math.cos(49 * w * t) + 11.0972825218235 * Math.cos(50 * w * t) + 11.048120605477019 * Math.cos(51 * w * t) + 11.131772429692889 * Math.cos(52 * w * t) + 11.16837324162626 * Math.cos(53 * w * t) + 11.20234663742689 * Math.cos(54 * w * t) + 11.168946912093276 * Math.cos(55 * w * t) + 11.232453079199907 * Math.cos(56 * w * t) + 11.226573733744909 * Math.cos(57 * w * t) + 11.238722501214294 * Math.cos(58 * w * t) + 11.273973720899942 * Math.cos(59 * w * t) + 11.28094074125373 * Math.cos(60 * w * t) + 11.278438891872302 * Math.cos(61 * w * t) + 11.261557068368198 * Math.cos(62 * w * t) + 11.356537332668553 * Math.cos(63 * w * t) + 11.323907071315954 * Math.cos(64 * w * t) + 11.323403994039978 * Math.cos(65 * w * t) + 11.371747458163183 * Math.cos(66 * w * t) + 11.348916503867938 * Math.cos(67 * w * t) + 11.396122714554444 * Math.cos(68 * w * t) + 11.392980048259092 * Math.cos(69 * w * t) + 11.361320977074227 * Math.cos(70 * w * t) + 11.378882702915288 * Math.cos(71 * w * t) + 11.440595520983234 * Math.cos(72 * w * t) + 11.418495277630496 * Math.cos(73 * w * t) + 11.455624120061904 * Math.cos(74 * w * t) + 11.425550761932602 * Math.cos(75 * w * t) + 11.433809707504071 * Math.cos(76 * w * t) + 11.424759368410033 * Math.cos(77 * w * t) + 11.465642548449132 * Math.cos(78 * w * t) + 11.466079537451366 * Math.cos(79 * w * t) + 11.520921921451706 * Math.cos(80 * w * t) + 11.479870464324247 * Math.cos(81 * w * t) + 11.489043462711534 * Math.cos(82 * w * t) + 11.482187400831691 * Math.cos(83 * w * t) + 11.46740768886853 * Math.cos(84 * w * t) + 11.495152356199672 * Math.cos(85 * w * t) + 11.482203223492197 * Math.cos(86 * w * t) + 11.508677835041603 * Math.cos(87 * w * t) + 11.507472144588244 * Math.cos(88 * w * t) + 11.518049787463857 * Math.cos(89 * w * t) + 11.524000924003415 * Math.cos(90 * w * t) + 11.55293187495274 * Math.cos(91 * w * t) + 11.543586475305636 * Math.cos(92 * w * t) + 11.56946611475487 * Math.cos(93 * w * t) + 11.54185053859195 * Math.cos(94 * w * t) + 11.524561130226854 * Math.cos(95 * w * t) + 11.535249886696985 * Math.cos(96 * w * t) + 11.538341003116434 * Math.cos(97 * w * t) + 11.53523279490294 * Math.cos(98 * w * t) + 11.518414152323173 * Math.cos(99 * w * t) + 11.50982883735219 * Math.cos(100 * w * t) + 11.52714947269514 * Math.cos(101 * w * t) + 11.528334512518178 * Math.cos(102 * w * t) + 11.56756268514303 * Math.cos(103 * w * t) + 11.536192464501262 * Math.cos(104 * w * t) + 11.59239996757071 * Math.cos(105 * w * t) + 11.545645938105576 * Math.cos(106 * w * t) + 11.570400435053132 * Math.cos(107 * w * t) + 11.618817728023863 * Math.cos(108 * w * t) + 11.568521428372074 * Math.cos(109 * w * t) + 11.597577421212286 * Math.cos(110 * w * t) + 11.567848579745528 * Math.cos(111 * w * t) + 11.553451991886314 * Math.cos(112 * w * t) + 11.552277578425096 * Math.cos(113 * w * t) + 11.547294312208425 * Math.cos(114 * w * t) + 11.551212647570946 * Math.cos(115 * w * t) + 11.619465661417815 * Math.cos(116 * w * t) + 11.62192854012292 * Math.cos(117 * w * t) + 11.597931748994407 * Math.cos(118 * w * t) + 11.564534547386174 * Math.cos(119 * w * t) + 11.550397204585591 * Math.cos(120 * w * t) + 11.583441366467317 * Math.cos(121 * w * t) + 11.591131659983802 * Math.cos(122 * w * t) + 11.579931479543434 * Math.cos(123 * w * t) + 11.609343313165983 * Math.cos(124 * w * t) + 11.604270526771073 * Math.cos(125 * w * t) + 11.59727400879893 * Math.cos(126 * w * t) + 11.606914498671722 * Math.cos(127 * w * t) + 11.62874679158087 * Math.cos(128 * w * t) + 11.59309309999325 * Math.cos(129 * w * t) + 11.623065790042014 * Math.cos(130 * w * t) + 11.62209600189101 * Math.cos(131 * w * t) + 11.625059739723511 * Math.cos(132 * w * t) + 11.570262503775497 * Math.cos(133 * w * t) + 11.611856395272566 * Math.cos(134 * w * t) + 11.628903625423733 * Math.cos(135 * w * t) + 11.582597090290141 * Math.cos(136 * w * t) + 11.634601587419686 * Math.cos(137 * w * t) + 11.625816455029412 * Math.cos(138 * w * t) + 11.640288325415984 * Math.cos(139 * w * t) + 11.669397580879629 * Math.cos(140 * w * t) + 11.56368923090375 * Math.cos(141 * w * t) + 11.61736577544947 * Math.cos(142 * w * t) + 11.625925570172319 * Math.cos(143 * w * t) + 11.6391031171899 * Math.cos(144 * w * t) + 11.6033070360546 * Math.cos(145 * w * t) + 11.639038968916472 * Math.cos(146 * w * t) + 11.664552713901257 * Math.cos(147 * w * t) + 11.592000079153195 * Math.cos(148 * w * t) + 11.62973903051535 * Math.cos(149 * w * t) + 11.626681692995515 * Math.cos(150 * w * t) + 11.63697786008014 * Math.cos(151 * w * t) + 11.607826634139775 * Math.cos(152 * w * t) + 11.596537084899566 * Math.cos(153 * w * t) + 11.608326058113255 * Math.cos(154 * w * t) + 11.644184134548075 * Math.cos(155 * w * t) + 11.57896455494999 * Math.cos(156 * w * t) + 11.623019713985467 * Math.cos(157 * w * t) + 11.617586582918783 * Math.cos(158 * w * t) + 11.675711914718192 * Math.cos(159 * w * t) + 11.63198915491183 * Math.cos(160 * w * t) + 11.615383661645803 * Math.cos(161 * w * t) + 11.598725986318405 * Math.cos(162 * w * t) + 11.608518075059854 * Math.cos(163 * w * t) + 11.650089898700138 * Math.cos(164 * w * t) + 11.617846378436683 * Math.cos(165 * w * t) + 11.600070625232592 * Math.cos(166 * w * t) + 11.629768839587284 * Math.cos(167 * w * t) + 11.65887806033067 * Math.cos(168 * w * t) + 11.62661587532679 * Math.cos(169 * w * t) + 11.690536264957302 * Math.cos(170 * w * t) + 11.651622621842668 * Math.cos(171 * w * t) + 11.657419274423916 * Math.cos(172 * w * t) + 11.631944823978637 * Math.cos(173 * w * t) + 11.61453037733296 * Math.cos(174 * w * t) + 11.639816459626275 * Math.cos(175 * w * t) + 11.635710785769623 * Math.cos(176 * w * t) + 11.666753232901979 * Math.cos(177 * w * t) + 11.668763153497668 * Math.cos(178 * w * t) + 11.643046298783226 * Math.cos(179 * w * t) + 11.637989553337938 * Math.cos(180 * w * t) + 11.669781756369263 * Math.cos(181 * w * t) + 11.610141441136447 * Math.cos(182 * w * t) + 442948.95838670904 * Math.sin(1 * w * t) + -527777.3336939958 * Math.sin(2 * w * t) + 17079.503854659088 * Math.sin(3 * w * t) + -7513.757673760924 * Math.sin(4 * w * t) + 702.2597654012458 * Math.sin(5 * w * t) + 131.95270889446084 * Math.sin(6 * w * t) + 183.69534589575335 * Math.sin(7 * w * t) + 163.47790974167995 * Math.sin(8 * w * t) + 143.51367422875572 * Math.sin(9 * w * t) + 131.20553397268557 * Math.sin(10 * w * t) + 119.72327214726097 * Math.sin(11 * w * t) + 110.38406823373894 * Math.sin(12 * w * t) + 102.27256468102502 * Math.sin(13 * w * t) + 95.14605155658319 * Math.sin(14 * w * t) + 88.98971021814098 * Math.sin(15 * w * t) + 83.52581327253912 * Math.sin(16 * w * t) + 78.68488083831195 * Math.sin(17 * w * t) + 74.38733473235187 * Math.sin(18 * w * t) + 70.48273080872018 * Math.sin(19 * w * t) + 66.94005905276943 * Math.sin(20 * w * t) + 63.76401552059762 * Math.sin(21 * w * t) + 60.846257491201946 * Math.sin(22 * w * t) + 58.199906179192794 * Math.sin(23 * w * t) + 55.716043396542176 * Math.sin(24 * w * t) + 53.42681734619823 * Math.sin(25 * w * t) + 51.332070123960335 * Math.sin(26 * w * t) + 49.35900455222118 * Math.sin(27 * w * t) + 47.566029989213824 * Math.sin(28 * w * t) + 45.880675837981315 * Math.sin(29 * w * t) + 44.29089640771852 * Math.sin(30 * w * t) + 42.81758586032994 * Math.sin(31 * w * t) + 41.43328737513367 * Math.sin(32 * w * t) + 40.077996791557915 * Math.sin(33 * w * t) + 38.886977994926745 * Math.sin(34 * w * t) + 37.70094667411282 * Math.sin(35 * w * t) + 36.60072970778139 * Math.sin(36 * w * t) + 35.56000395251441 * Math.sin(37 * w * t) + 34.58519835004622 * Math.sin(38 * w * t) + 33.60152027108163 * Math.sin(39 * w * t) + 32.70536788165262 * Math.sin(40 * w * t) + 31.824660658138985 * Math.sin(41 * w * t) + 30.980630963227423 * Math.sin(42 * w * t) + 30.230305692206453 * Math.sin(43 * w * t) + 29.493568520162967 * Math.sin(44 * w * t) + 28.773028594302193 * Math.sin(45 * w * t) + 28.086297749113644 * Math.sin(46 * w * t) + 27.385894442557078 * Math.sin(47 * w * t) + 26.752568189880204 * Math.sin(48 * w * t) + 26.143012129721484 * Math.sin(49 * w * t) + 25.546339898398777 * Math.sin(50 * w * t) + 24.960786767290802 * Math.sin(51 * w * t) + 24.449172407393373 * Math.sin(52 * w * t) + 23.88116593236108 * Math.sin(53 * w * t) + 23.387882225325004 * Math.sin(54 * w * t) + 22.922554608026847 * Math.sin(55 * w * t) + 22.396847327979344 * Math.sin(56 * w * t) + 21.930222168742137 * Math.sin(57 * w * t) + 21.54708457449513 * Math.sin(58 * w * t) + 21.108352629379894 * Math.sin(59 * w * t) + 20.614066213081163 * Math.sin(60 * w * t) + 20.250063274425422 * Math.sin(61 * w * t) + 19.86609358993157 * Math.sin(62 * w * t) + 19.47496676702847 * Math.sin(63 * w * t) + 19.131622501046923 * Math.sin(64 * w * t) + 18.74387941146975 * Math.sin(65 * w * t) + 18.40088596325372 * Math.sin(66 * w * t) + 18.04885480538798 * Math.sin(67 * w * t) + 17.72426459414611 * Math.sin(68 * w * t) + 17.38941778743379 * Math.sin(69 * w * t) + 17.073377444635593 * Math.sin(70 * w * t) + 16.77856237290753 * Math.sin(71 * w * t) + 16.45484366277835 * Math.sin(72 * w * t) + 16.17474077532932 * Math.sin(73 * w * t) + 15.884238881330978 * Math.sin(74 * w * t) + 15.616071930973579 * Math.sin(75 * w * t) + 15.288884216942947 * Math.sin(76 * w * t) + 15.025720530249027 * Math.sin(77 * w * t) + 14.787941128762139 * Math.sin(78 * w * t) + 14.566172479969534 * Math.sin(79 * w * t) + 14.31379347947354 * Math.sin(80 * w * t) + 13.99651825621853 * Math.sin(81 * w * t) + 13.77700202416814 * Math.sin(82 * w * t) + 13.532783358809867 * Math.sin(83 * w * t) + 13.264882923372681 * Math.sin(84 * w * t) + 13.067551912829442 * Math.sin(85 * w * t) + 12.87487504294933 * Math.sin(86 * w * t) + 12.631822872585388 * Math.sin(87 * w * t) + 12.410130253539519 * Math.sin(88 * w * t) + 12.222506387651043 * Math.sin(89 * w * t) + 12.017029487755769 * Math.sin(90 * w * t) + 11.810398394357213 * Math.sin(91 * w * t) + 11.575290508803604 * Math.sin(92 * w * t) + 11.424629948894436 * Math.sin(93 * w * t) + 11.216168377199477 * Math.sin(94 * w * t) + 11.022627115217851 * Math.sin(95 * w * t) + 10.834185769384721 * Math.sin(96 * w * t) + 10.647338545853174 * Math.sin(97 * w * t) + 10.433579830003666 * Math.sin(98 * w * t) + 10.248899276203996 * Math.sin(99 * w * t) + 10.067850081986373 * Math.sin(100 * w * t) + 9.946292980841102 * Math.sin(101 * w * t) + 9.76242033543617 * Math.sin(102 * w * t) + 9.607177895611303 * Math.sin(103 * w * t) + 9.436248177500993 * Math.sin(104 * w * t) + 9.22287714219933 * Math.sin(105 * w * t) + 9.13104649307228 * Math.sin(106 * w * t) + 8.962150624794358 * Math.sin(107 * w * t) + 8.764279772865724 * Math.sin(108 * w * t) + 8.602186441656507 * Math.sin(109 * w * t) + 8.450993922560347 * Math.sin(110 * w * t) + 8.286546159468037 * Math.sin(111 * w * t) + 8.168137939154171 * Math.sin(112 * w * t) + 7.99926384683474 * Math.sin(113 * w * t) + 7.8693660694812015 * Math.sin(114 * w * t) + 7.687828236748955 * Math.sin(115 * w * t) + 7.584710239863332 * Math.sin(116 * w * t) + 7.393188332415227 * Math.sin(117 * w * t) + 7.292164840088505 * Math.sin(118 * w * t) + 7.152877989040893 * Math.sin(119 * w * t) + 7.052468533344278 * Math.sin(120 * w * t) + 6.8654699118013065 * Math.sin(121 * w * t) + 6.772529298208348 * Math.sin(122 * w * t) + 6.605672099143536 * Math.sin(123 * w * t) + 6.482449743076032 * Math.sin(124 * w * t) + 6.363363535094534 * Math.sin(125 * w * t) + 6.210534808641873 * Math.sin(126 * w * t) + 6.102127942845604 * Math.sin(127 * w * t) + 5.961232449220098 * Math.sin(128 * w * t) + 5.8337784368511905 * Math.sin(129 * w * t) + 5.716569596734463 * Math.sin(130 * w * t) + 5.567924934559123 * Math.sin(131 * w * t) + 5.481891244668877 * Math.sin(132 * w * t) + 5.3117985053485715 * Math.sin(133 * w * t) + 5.1905025564684575 * Math.sin(134 * w * t) + 5.1105064156327265 * Math.sin(135 * w * t) + 4.965445614140685 * Math.sin(136 * w * t) + 4.879858980845935 * Math.sin(137 * w * t) + 4.771789330232463 * Math.sin(138 * w * t) + 4.618749508755055 * Math.sin(139 * w * t) + 4.5092827078505735 * Math.sin(140 * w * t) + 4.365320624351511 * Math.sin(141 * w * t) + 4.290218137231824 * Math.sin(142 * w * t) + 4.146506873653758 * Math.sin(143 * w * t) + 4.054187973271177 * Math.sin(144 * w * t) + 3.9280800704003025 * Math.sin(145 * w * t) + 3.8462057268927037 * Math.sin(146 * w * t) + 3.7180804541291 * Math.sin(147 * w * t) + 3.6118050685488052 * Math.sin(148 * w * t) + 3.5045886779787607 * Math.sin(149 * w * t) + 3.355773769784968 * Math.sin(150 * w * t) + 3.248307181788316 * Math.sin(151 * w * t) + 3.166911693395462 * Math.sin(152 * w * t) + 3.0639339801101864 * Math.sin(153 * w * t) + 2.9355159148454244 * Math.sin(154 * w * t) + 2.840557712361808 * Math.sin(155 * w * t) + 2.7180615965762067 * Math.sin(156 * w * t) + 2.6430766364626823 * Math.sin(157 * w * t) + 2.496978687487488 * Math.sin(158 * w * t) + 2.419259351304582 * Math.sin(159 * w * t) + 2.3086394361315397 * Math.sin(160 * w * t) + 2.203203050431179 * Math.sin(161 * w * t) + 2.1241447813697185 * Math.sin(162 * w * t) + 1.9952324217698756 * Math.sin(163 * w * t) + 1.8859517455097787 * Math.sin(164 * w * t) + 1.7695418967219978 * Math.sin(165 * w * t) + 1.7058757495782766 * Math.sin(166 * w * t) + 1.586117034670924 * Math.sin(167 * w * t) + 1.4772112102898936 * Math.sin(168 * w * t) + 1.3834063432057258 * Math.sin(169 * w * t) + 1.2324124293927936 * Math.sin(170 * w * t) + 1.1670810019852262 * Math.sin(171 * w * t) + 1.0870836425937864 * Math.sin(172 * w * t) + 0.9443953801298829 * Math.sin(173 * w * t) + 0.8270388035270422 * Math.sin(174 * w * t) + 0.8095320020620931 * Math.sin(175 * w * t) + 0.6211147018505693 * Math.sin(176 * w * t) + 0.559512982044628 * Math.sin(177 * w * t) + 0.45884289487065505 * Math.sin(178 * w * t) + 0.36969457369531694 * Math.sin(179 * w * t) + 0.27661029440847956 * Math.sin(180 * w * t) + 0.18609880946122562 * Math.sin(181 * w * t) + 0.04280156381014947 * Math.sin(182 * w * t);

        y /= 1000;

        return y;
    }
}
